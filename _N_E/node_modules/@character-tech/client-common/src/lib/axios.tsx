import { AxiosInstance, AxiosStatic } from 'axios';
import { v4 as uuidv4 } from 'uuid';
import { getOriginId } from './axiosConstants';

export let axios: () => AxiosStatic | AxiosInstance;

export const setupAxios = (_axios: () => AxiosStatic | AxiosInstance) => {
  // Add a request interceptor
  _axios().interceptors.request.use(
    config => {
      if (config.baseURL?.includes('neo')) {
        // Do something before request is sent
        config.headers['request-id'] = uuidv4();
        config.headers['origin-id'] = getOriginId();
      }

      return config;
    },
    error => {
      // Do something with request error
      return Promise.reject(error);
    },
  );
  axios = _axios;
};
